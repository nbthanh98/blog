---
title: Đóng gói ứng dụng spring boot với Helm
date: '2022-12-01'
tags: ['api', 'rest-api', 'springboot']
series: ['k8s-spring-boot']
draft: false
authors: ['thanhnb']
images: ['/static/images/ogps/k8s-springboot.png']
summary: 'Trong bài viết này, chúng ta sẽ tìm hiểu cách đóng gói ứng dụng spring boot với Helm.'
index: 7
---

<TOCInline toc={props.toc} asDisclosure />

## 1. Giới thiệu chung
Trong bài viết này chúng ta sẽ cùng nhau tìm hiểu về Helm, cấu trúc Helm Chart và cách triển khai ứng dụng Spring boot trên cụm Kubernetes với Helm.

## 2. Cài đặt Helm
Hiện tại Helm đang có hai phiên bản [Helm2](https://v2.helm.sh/) và [Helm3](https://helm.sh/). Trong bài viết này chúng ta sẽ sử dụng Helm3, bạn có thể cài đặt theo hướng dẫn tại [trang web chính thức của Helm3](https://helm.sh/docs/intro/install/).

```shell
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod 700 get_helm.sh
./get_helm.sh

# Kiểm tra phiên bản Helm
helm version
version.BuildInfo{Version:"v3.14.0", GitCommit:"3fc9f4b2638e76f26739cd77c7017139be81d0ea", GitTreeState:"clean", GoVersion:"go1.21.5"}
```

## 3. Tìm hiểu và triển khai ứng dụng Spring boot với Helm

### 3.1. Helm Chart là gì?
- Helm là package manager (công cụ triển khai - CLI tool) giúp đơn giản hóa việc cấu hình, triển khai và quản lý ứng dụng trên cụm Kubernetes. Helm đóng gói các file cấu hình thành một đơn vị triển khai gọi là Helm chart.
- Helm chart gồm tất cả file cấu hình Kubernetes resources (như deployments, services, config map,...) cần thiết để triển khai ứng dụng trên cụm Kuberentes. Trong Helm chart thường chứa các file cấu hình dạng template thay vì hardcode. Khi triển khai Helm sẽ lấy giá trị cấu hình định nghĩa trong file values.yaml kết hợp với file template để tạo thành file cấu hình hoàn chỉnh. Việc này giúp cấu hình ứng dụng linh động hơn và có thể tái sử dụng Helm chart khi triển khai ứng dụng trên nhiều môi trường khác nhau.

Bạn có thể tham khảo thêm về Helm tại [trang web chính thức của Helm](https://helm.sh/docs/).

### 3.2. Cấu trúc Helm Chart
Helm chart là package (đơn vị triển khai được quản lý bởi Helm) chứa tất cả file cấu hình để triển khai ứng dụng trên cụm Kubernetes, một Helm chart có cấu trúc như sau:

```shell
student-service/
├── charts
├── Chart.yaml
├── templates
│   ├── deployment.yaml
│   ├── _helpers.tpl
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── NOTES.txt
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml
```
- **charts**: Mặc định thư mục này sẽ trống (empty), có thể thêm các chart vào bên trong thư mục này nếu triển khai chart chính cần phụ thuộc vào chúng.
- **Chart.yaml**: Chứa thông tin về chart như: version, tên, mô tả,...
- **templates**: Chứa các file template cấu hình Kubernetes resources (như deployments, services,...) cần thiết để trển khai ứng dụng trên cụm Kubernetes. Các file template này thường chứa các biến, hàm để khi triển khai Helm sẽ lấy các tham số được định nghĩa trong file values.yaml tạo ra các cấu hình hoàn chỉnh.
- **values.yaml**: Chứa giá trị cho các tham số cấu hình cho các template trong thư mục "templates" như: imageName, imageTag, replicas,.. Chúng ta có thể tạo ra nhiều file values.yaml cho các môi trường khác nhau ví dụ: dev-values.yaml, uat-values.yaml, prod-values.yaml,.. Khi triển khai Helm Chart thì sẽ chỉ định file tương ứng với môi trường đang triển khai.